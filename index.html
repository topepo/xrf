<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>eXtreme RuleFit • xrf</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="eXtreme RuleFit">
<meta property="og:description" content="An implementation of the RuleFit algorithm as described in Friedman &amp; Popescu 
  (2008) &lt;doi:10.1214/07-AOAS148&gt;. eXtreme Gradient Boosting (XGBoost) is used 
  to build rules, and glmnet is used to fit a sparse linear model on the raw and rule features. The result
  is a model that learns similarly to a tree ensemble, while often offering improved interpretability
  and achieving improved scoring runtime in live applications. Several algorithms for
  reducing rule complexity are provided, most notably hyperrectangle de-overlapping. All algorithms scale to 
  several million rows and support sparse representations to handle tens of thousands of dimensions.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">xrf</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/holub008/xrf/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="extreme-rulefit" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#extreme-rulefit" class="anchor"></a>eXtreme RuleFit</h1></div>
<p><img src="/docs/images/ptcas_rulefit.jpg" width="400px"></p>
<p><a href="https://github.com/holub008/xrf/actions"><img src="https://github.com/holub008/xrf/workflows/R-CMD-check/badge.svg" alt="R build status"></a> <a href="https://codecov.io/gh/holub008/xrf?branch=master"><img src="https://codecov.io/gh/holub008/xrf/branch/master/graph/badge.svg" alt="Codecov test coverage"></a> <a href="https://CRAN.R-project.org/package=xrf"><img src="https://cranlogs.r-pkg.org/badges/xrf" alt="xrf on CRAN"></a></p>
<div id="install" class="section level2">
<h2 class="hasAnchor">
<a href="#install" class="anchor"></a>Install</h2>
<p>For current CRAN release:</p>
<div class="sourceCode" id="cb1"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">'xrf'</span>)</pre></div>
<p>For the current development version:</p>
<div class="sourceCode" id="cb2"><pre class="r"><span class="kw pkg">devtools</span><span class="kw ns">::</span><span class="fu">install_git</span>(<span class="st">'https://github.com/holub008/xrf'</span>)</pre></div>
</div>
<div id="about" class="section level2">
<h2 class="hasAnchor">
<a href="#about" class="anchor"></a>About</h2>
<p>RuleFit (described in <a href="http://statweb.stanford.edu/~jhf/ftp/RuleFit.pdf">Friedman &amp; Popescu</a>) is a clever model combining tree ensembles and linear models. The goal is to produce a model with comparable performance to a tree ensemble, with the interpretability of a linear model.</p>
<p>The general algorithm follows:</p>
<ul>
<li>Fit a tree ensemble to the data</li>
<li>Build a set of rules as the set of root -&gt; leaf traversals from each tree.
<ul>
<li>Each traversal becomes a rule via conjunction</li>
</ul>
</li>
<li>Evaluate the rules on the data to build a rule feature set</li>
<li>Fit a linear model to the original feature set joined with the rule feature set
<ul>
<li>The LASSO may be used to build a sparse final model</li>
</ul>
</li>
</ul>
<div id="specifics-to-xrf" class="section level3">
<h3 class="hasAnchor">
<a href="#specifics-to-xrf" class="anchor"></a>Specifics to xrf</h3>
<ul>
<li>A gradient boosted tree ensemble is used to generate rules
<ul>
<li>Specifically, <a href="https://xgboost.readthedocs.io/en/latest/">XGBoost</a>
</li>
<li>For a general description of tree boosting &amp; gradient boosting, see <a href="https://github.com/holub008/snippets/blob/master/tree_learning/tree_learning_overview.pdf">this document</a>.</li>
</ul>
</li>
<li>Overlapped rules belonging to the same subspace can be de-overlapped to improve model interpretability
<ul>
<li>For an illustration of de-overlapping xrf models, see the “De-overlapping rules” section below</li>
<li>For a description of this algorithm, see <a href="https://github.com/holub008/snippets/blob/master/overlapped_hyperrectangles/overlapped_hyperrectangles.pdf">this document</a>
</li>
</ul>
</li>
</ul>
</div>
<div id="comparison-to-alternatives" class="section level3">
<h3 class="hasAnchor">
<a href="#comparison-to-alternatives" class="anchor"></a>Comparison to alternatives</h3>
<p>Several implementations of RuleFit are available for R: <a href="https://CRAN.R-project.org/package=pre">pre</a>, <a href="https://CRAN.R-project.org/package=horserule">horserule</a>, and <a href="https://github.com/Zelazny7/rulefit">rulefit</a>. xrf improves on some aspects of these by:</p>
<ul>
<li>Usually building more accurate models at fixed number of parameters</li>
<li>Usually building models faster</li>
<li>Building models that predict for new factor-levels</li>
<li>Providing a more concise and limited interface</li>
<li>Tested &amp; actively maintained for fewer bugs</li>
</ul>
<p>On the last point, as of April 2019, the ‘pre’ and ‘rulefit’ packages fail to build a model on the census income example below due to bugs.</p>
</div>
</div>
<div id="example" class="section level2">
<h2 class="hasAnchor">
<a href="#example" class="anchor"></a>Example</h2>
<p>Here we predict whether an individual’s income is greater than $50,000 using census data.</p>
<div class="sourceCode" id="cb3"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">RCurl</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">xrf</span>)

<span class="co"># grabbing data from uci</span>
<span class="no">census_income_text</span> <span class="kw">&lt;-</span> <span class="fu">getURL</span>(<span class="st">'https://archive.ics.uci.edu/ml/machine-learning-databases/adult/adult.data'</span>)
<span class="no">census_income</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/textconnections.html">textConnection</a></span>(<span class="no">census_income_text</span>), <span class="kw">header</span><span class="kw">=</span><span class="no">F</span>, <span class="kw">stringsAsFactors</span> <span class="kw">=</span> <span class="no">F</span>)
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">census_income</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'age'</span>, <span class="st">'workclass'</span>, <span class="st">'fnlwgt'</span>, <span class="st">'education'</span>, <span class="st">'education_num'</span>, <span class="st">'marital_status'</span>,
                            <span class="st">'occupation'</span>, <span class="st">'relationship'</span>, <span class="st">'race'</span>, <span class="st">'sex'</span>, <span class="st">'capital_gain'</span>, <span class="st">'capital_loss'</span>,
                            <span class="st">'hours_per_week'</span>, <span class="st">'native_country'</span>, <span class="st">'above_50k'</span>)

<span class="no">m_xrf</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/xrf.html">xrf</a></span>(<span class="no">above_50k</span> ~ <span class="no">.</span>, <span class="no">census_income</span>, <span class="kw">family</span> <span class="kw">=</span> <span class="st">'binomial'</span>,
             <span class="kw">xgb_control</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">nrounds</span> <span class="kw">=</span> <span class="fl">100</span>, <span class="kw">max_depth</span> <span class="kw">=</span> <span class="fl">3</span>))</pre></div>
<div id="comparison" class="section level3">
<h3 class="hasAnchor">
<a href="#comparison" class="anchor"></a>Comparison</h3>
<p>Here we employ out-of-the-box RuleFit from pre &amp; xrf, as well as raw xgboost &amp; glmnet models.</p>
<div class="sourceCode" id="cb4"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">pre</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">rulefit</span>) <span class="co"># installed via devtools::install_git("https://github.com/Zelazny7/rulefit")</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">horserule</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">glmnet</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">xgboost</span>)

<span class="no">auc</span> <span class="kw">&lt;-</span> <span class="kw">function</span> (<span class="no">prediction</span>, <span class="no">actual</span>) {
  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html">stopifnot</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">actual</span>)) <span class="kw">==</span> <span class="fl">2</span>)
  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html">stopifnot</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">prediction</span>) <span class="kw">==</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">actual</span>))
  <span class="no">mann_whit</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/wilcox.test.html">wilcox.test</a></span>(<span class="no">prediction</span> ~ <span class="no">actual</span>)$<span class="no">statistic</span>
  <span class="fu"><a href="https://rdrr.io/r/base/unname.html">unname</a></span>(<span class="fl">1</span> - <span class="no">mann_whit</span>/(<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">actual</span>) * <span class="fu"><a href="https://rdrr.io/r/base/double.html">as.double</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(!<span class="no">actual</span>))))
}

<span class="no">census_income</span> <span class="kw">&lt;-</span> <span class="no">census_income</span> <span class="kw">%&gt;%</span>
  <span class="co"># pre is picky about data types </span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">mutate_if</a></span>(<span class="no">is.character</span>, <span class="no">as.factor</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(
    <span class="kw">above_50k</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="no">above_50k</span>) <span class="kw">==</span> <span class="st">' &gt;50K'</span>
  )

<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">55455</span>)
<span class="no">train_ix</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample.html">sample</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">census_income</span>), <span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">census_income</span>) * <span class="fl">.66</span>))
<span class="no">census_train</span> <span class="kw">&lt;-</span> <span class="no">census_income</span>[<span class="no">train_ix</span>, ]
<span class="no">census_test</span> <span class="kw">&lt;-</span> <span class="no">census_income</span>[-<span class="no">train_ix</span>, ]
<span class="no">census_mat</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span>(<span class="no">above_50k</span> ~ <span class="no">.</span>, <span class="no">census_income</span>)
<span class="no">census_train_mat</span> <span class="kw">&lt;-</span> <span class="no">census_mat</span>[<span class="no">train_ix</span>, ]
<span class="no">census_test_mat</span> <span class="kw">&lt;-</span> <span class="no">census_mat</span>[-<span class="no">train_ix</span>, ]

<span class="co"># note, as of 2019-04-17, the pre example fails to work (with an error for a new level in model.frame). as such, the below comparison is not one to one</span>
<span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span>(<span class="no">m_pre</span> <span class="kw">&lt;-</span> <span class="fu">pre</span>(<span class="no">above_50k</span> ~ <span class="no">.</span>, <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span>(<span class="no">census_train</span>),
                         <span class="kw">family</span> <span class="kw">=</span> <span class="st">'binomial'</span>, <span class="kw">ntrees</span> <span class="kw">=</span> <span class="fl">100</span>, <span class="kw">maxdepth</span> <span class="kw">=</span> <span class="fl">3</span>, <span class="kw">tree.unbiased</span> <span class="kw">=</span> <span class="fl">TRUE</span>))
<span class="co"># note, as of 2019-04-25, this example fails by attempting to access names() of a sparse matrix (seems it should be using colnames())</span>
<span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span>({
  <span class="no">m_gbm</span> <span class="kw">&lt;-</span> <span class="fu">gbm.fit</span>(<span class="no">census_train_mat</span>, <span class="no">census_train</span>$<span class="no">above_50k</span>, <span class="kw">distribution</span><span class="kw">=</span><span class="st">"bernoulli"</span>, <span class="kw">interaction.depth</span> <span class="kw">=</span> <span class="fl">3</span>, <span class="kw">shrinkage</span> <span class="kw">=</span> <span class="fl">0.1</span>, <span class="kw">verbose</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
  <span class="no">rf_plan</span> <span class="kw">&lt;-</span> <span class="fu">rulefit</span>(<span class="no">m_gbm</span>, <span class="kw">n.trees</span> <span class="kw">=</span> <span class="fl">100</span>)
  <span class="no">m_rf</span> <span class="kw">&lt;-</span> <span class="fu">train</span>(<span class="no">rf_plan</span>, <span class="no">census_train_mat</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">census_train</span>$<span class="no">above_50k</span>, <span class="kw">family</span> <span class="kw">=</span> <span class="st">"binomial"</span>)
})
<span class="co"># note that this involves no hyperparameter tuning</span>
<span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span>({
  <span class="no">m_hrf</span> <span class="kw">&lt;-</span> <span class="fu">HorseRuleFit</span>(<span class="no">census_train_mat</span>, <span class="no">census_train</span>$<span class="no">above_50k</span>, <span class="kw">ntree</span><span class="kw">=</span><span class="fl">100</span>, <span class="kw">L</span><span class="kw">=</span><span class="fl">3</span>)
})
<span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span>(<span class="no">m_xrf</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/xrf.html">xrf</a></span>(<span class="no">above_50k</span> ~ <span class="no">.</span>, <span class="no">census_train</span>, <span class="kw">family</span> <span class="kw">=</span> <span class="st">'binomial'</span>,
             <span class="kw">xgb_control</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">nrounds</span> <span class="kw">=</span> <span class="fl">100</span>, <span class="kw">max_depth</span> <span class="kw">=</span> <span class="fl">3</span>)))
<span class="no">m_xgb</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xgboost/man/xgb.train.html">xgboost</a></span>(<span class="no">census_train_mat</span>, <span class="no">census_train</span>$<span class="no">above_50k</span>, <span class="kw">max_depth</span> <span class="kw">=</span> <span class="fl">3</span>, <span class="kw">nrounds</span> <span class="kw">=</span> <span class="fl">100</span>, <span class="kw">objective</span> <span class="kw">=</span> <span class="st">'binary:logistic'</span>)
<span class="no">m_glm</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/glmnet/man/cv.glmnet.html">cv.glmnet</a></span>(<span class="no">census_train_mat</span>, <span class="no">census_train</span>$<span class="no">above_50k</span>, <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">1</span>)

<span class="fu"><a href="https://rdrr.io/pkg/glmnet/man/glmnet-internal.html">auc</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="no">m_pre</span>, <span class="no">census_test</span>), <span class="no">census_test</span>$<span class="no">above_50k</span>)
<span class="fu"><a href="https://rdrr.io/pkg/glmnet/man/glmnet-internal.html">auc</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="no">m_hrf</span>, <span class="no">census_test_mat</span>), <span class="no">census_test</span>$<span class="no">above_50k</span>)
<span class="fu"><a href="https://rdrr.io/pkg/glmnet/man/glmnet-internal.html">auc</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="no">m_xrf</span>, <span class="no">census_test</span>), <span class="no">census_test</span>$<span class="no">above_50k</span>)
<span class="fu"><a href="https://rdrr.io/pkg/glmnet/man/glmnet-internal.html">auc</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="no">m_glm</span>, <span class="kw">newx</span> <span class="kw">=</span> <span class="no">census_test_mat</span>, <span class="kw">s</span> <span class="kw">=</span> <span class="st">'lambda.min'</span>), <span class="no">census_test</span>$<span class="no">above_50k</span>)
<span class="fu"><a href="https://rdrr.io/pkg/glmnet/man/glmnet-internal.html">auc</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="no">m_xgb</span>, <span class="kw">newdata</span> <span class="kw">=</span> <span class="no">census_test_mat</span>, <span class="kw">s</span> <span class="kw">=</span> <span class="st">'lambda.min'</span>), <span class="no">census_test</span>$<span class="no">above_50k</span>)</pre></div>
<p>With results (on a 2018 Macbook Pro, 16Gb Memory, 6 core i7, mojave):</p>
<table class="table">
<thead><tr class="header">
<th>Model</th>
<th>Time (s)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>xrf</td>
<td>73</td>
</tr>
<tr class="even">
<td>pre</td>
<td>211*</td>
</tr>
<tr class="odd">
<td>horserule</td>
<td>29</td>
</tr>
</tbody>
</table>
<p>On the test set:</p>
<table class="table">
<thead><tr class="header">
<th>Model</th>
<th>AUC</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>xrf</td>
<td>.924</td>
</tr>
<tr class="even">
<td>pre</td>
<td>.906*</td>
</tr>
<tr class="odd">
<td>horserule</td>
<td>.892</td>
</tr>
<tr class="even">
<td>xgboost</td>
<td>.926</td>
</tr>
<tr class="odd">
<td>glmnet</td>
<td>.892</td>
</tr>
</tbody>
</table>
<p>xrf has the highest accuracy among RuleFit models, nearly comparable to the tree ensemble. horserule delivered a model much faster, but its accuracy was no better than the LASSO fit. This is likely due to aggressive rule regularization, which may be tuned by altering the out of the box hyperparameters.</p>
</div>
</div>
<div id="de-overlapping-rules" class="section level2">
<h2 class="hasAnchor">
<a href="#de-overlapping-rules" class="anchor"></a>De-overlapping rules</h2>
<p>Overlapped rules occur when two or more rules belonging to the same subspace are not in mutual exclusion; de-overlapping guarantees that all rules belonging to the same subspace are in mutual exclusion. For example, the rules:</p>
<ul>
<li>age &lt; 50 &amp; income &lt; 50,000</li>
<li>age &lt; 60 &amp; income &gt; 40,000</li>
</ul>
<p>belong to the same subspace but are not in mutual exclusion (e.g. at age=45 &amp; income=45,000). They can be de-overlapped to, for example:</p>
<ul>
<li>age &lt; 50 &amp; income &lt; 40,000</li>
<li>age &lt; 50 &amp; income &gt;= 40,000 &amp; income &lt; 50,000</li>
<li>age &lt; 60 &amp; age &gt;= 50 &amp; income &gt;= 40,000 &amp; income &lt; 50,000</li>
<li>age &lt; 60 &amp; income &lt; 60</li>
</ul>
<p>which is one of infinite possible de-overlappings; this de-overlapping is ideal because</p>
<ul>
<li>it is small</li>
<li>it allows all “effects” from the original 2 rules to be exactly captured (i.e. none of the boundaries are broken)</li>
</ul>
<p>The following example is somewhat contrived (in that it only uses one feature), but demonstrates how de-overlapping can prove useful in interpreting your model. To de-overlap the derived ruleset, simply specify <code>deoverlap=TRUE</code>:</p>
<pre class="{r}"><code><a href="https://rdrr.io/r/base/Random.html">set.seed(55455)
m_xrf_overlap &lt;- xrf(above_50k ~ capital_gain, census_income, family = 'binomial', 
                     xgb_control = list(nrounds = 100, max_depth = 1), deoverlap = FALSE)
m_xrf_deoverlap &lt;- xrf(above_50k ~ capital_gain, census_income, family = 'binomial', 
                       xgb_control = list(nrounds = 100, max_depth = 1), deoverlap = TRUE)
                       
coef_overlap &lt;- coef(m_xrf_overlap, lambda = 'lambda.1se')
coef_deoverlap &lt;- coef(m_xrf_deoverlap, lambda = 'lambda.1se')</a></code></pre>
<p>Looking at the overlapped model:</p>
<div class="sourceCode" id="cb6"><pre class="r"><span class="no">coef_overlap</span> <span class="kw">%&gt;%</span>
 <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">coefficient_lambda.1se</span> <span class="kw">!=</span> <span class="fl">0</span>) <span class="kw">%&gt;%</span>
 <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(<span class="no">rule</span>)</pre></div>
<pre><code>   coefficient_lambda.1se        term               rule
1            3.757519e+00 (Intercept)               &lt;NA&gt;
2           -1.811956e+00        r0_1  capital_gain&lt;5119
3            3.465927e-09        r0_2 capital_gain&gt;=5119
4           -3.586284e+00        r1_1  capital_gain&lt;7074
5            4.433387e-09        r1_2 capital_gain&gt;=7074
6           -2.026456e+00       r10_1  capital_gain&lt;4244
7            1.402758e-09       r10_2 capital_gain&gt;=4244
8           -1.842004e+00       r11_1  capital_gain&lt;3048
9            1.423088e-10       r11_2 capital_gain&gt;=3048
10           2.758517e+00       r14_1  capital_gain&lt;3120
11          -1.295516e-10       r14_2 capital_gain&gt;=3120
12           8.893485e-01       r50_1  capital_gain&lt;5316
13          -1.447534e-10       r50_2 capital_gain&gt;=5316
14           5.068947e-01       r59_1  capital_gain&lt;4401
15          -4.496979e-11       r59_2 capital_gain&gt;=4401
16          -8.325515e-03       r86_1  capital_gain&lt;7566
17           1.895608e-11       r86_2 capital_gain&gt;=7566</code></pre>
<p>Notice that the rules are not in exclusion. To understand the impact of capital gain on income, we have to add up no less than 7 coefficients for <em>any</em> value of capital gain. Matters are made more confusing by effectively 0 coefficients on many of the ‘&gt;=’ rules, likely a numerical issue in the LASSO as a result of the substantial collinearity.</p>
<p>Now for the de-overlapped model:</p>
<div class="sourceCode" id="cb8"><pre class="r"><span class="no">coef_deoverlap</span> <span class="kw">%&gt;%</span>
 <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">coefficient_lambda.1se</span> <span class="kw">!=</span> <span class="fl">0</span>) <span class="kw">%&gt;%</span>
 <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(<span class="no">term</span>)</pre></div>
<pre><code>  coefficient_lambda.1se              term                                   rule
1              -1.007898       (Intercept)                                   &lt;NA&gt;
2              -0.345907 X1_capital_gain_1                      capital_gain&lt;3048
3               2.366051 X1_capital_gain_2 capital_gain&gt;=3048 &amp; capital_gain&lt;3120
4              -1.520116 X1_capital_gain_3 capital_gain&gt;=3120 &amp; capital_gain&lt;4244
5               1.728206 X1_capital_gain_4 capital_gain&gt;=4244 &amp; capital_gain&lt;4401
6               2.888030 X1_capital_gain_6 capital_gain&gt;=5119 &amp; capital_gain&lt;5316
7               3.206441 X1_capital_gain_8 capital_gain&gt;=7074 &amp; capital_gain&lt;7566
8               3.927737 X1_capital_gain_9                     capital_gain&gt;=7566</code></pre>
<p>How slick is that! We have:</p>
<ul>
<li>fewer coefficients</li>
<li>mutually exclusive coefficients</li>
<li>numerical stability</li>
</ul>
<p>Effects are immediately available by doing a lookup in the exclusive rules. This is a great win for interpretability.</p>
<p>As mentioned above, this example is contrived in that it uses <code>depth=1</code> trees (i.e. conjunctions of size 1). As depth increases, interpretability can suffer regardless de-overlapping if the final ruleset is non-sparse. However, for certain problems, particularly small depth or sparse effects, de-overlapping can be a boon for interpretability.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Download from CRAN at <br><a href="https://cloud.r-project.org/package=xrf">https://​cloud.r-project.org/​package=xrf</a>
</li>
<li>Browse source code at <br><a href="https://github.com/holub008/xrf/">https://​github.com/​holub008/​xrf/​</a>
</li>
<li>Report a bug at <br><a href="https://github.com/holub008/xrf/issues">https://​github.com/​holub008/​xrf/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>
<div class="community">
<h2>Community</h2>
<ul class="list-unstyled">
<li><a href="CONTRIBUTING.html">Contributing guide</a></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Karl Holub <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p>Developed by Karl Holub.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
